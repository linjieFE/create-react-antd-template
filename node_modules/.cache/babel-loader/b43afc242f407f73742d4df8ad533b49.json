{"ast":null,"code":"import \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/tag/style\";\nimport _Tag from \"antd/es/tag\";\nimport \"antd/es/collapse/style\";\nimport _Collapse from \"antd/es/collapse\";\nvar _jsxFileName = \"/Users/flexiv/Downloads/react-antd-admin-template-master/src/views/zip/index.jsx\";\nimport React, { Component } from \"react\";\nimport { excelList } from \"@/api/excel\";\nconst {\n  Panel\n} = _Collapse;\nconst columns = [{\n  title: \"Id\",\n  dataIndex: \"id\",\n  key: \"id\",\n  width: 200,\n  align: \"center\"\n}, {\n  title: \"Title\",\n  dataIndex: \"title\",\n  key: \"title\",\n  width: 200,\n  align: \"center\"\n}, {\n  title: \"Author\",\n  key: \"author\",\n  dataIndex: \"author\",\n  width: 100,\n  align: \"center\",\n  render: author => /*#__PURE__*/React.createElement(_Tag, {\n    key: author,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 25\n    }\n  }, author)\n}, {\n  title: \"Readings\",\n  dataIndex: \"readings\",\n  key: \"readings\",\n  width: 195,\n  align: \"center\"\n}, {\n  title: \"Date\",\n  dataIndex: \"date\",\n  key: \"date\",\n  width: 195,\n  align: \"center\"\n}];\n\nclass Zip extends Component {\n  constructor(...args) {\n    super(...args);\n    this._isMounted = false;\n    this.state = {\n      list: [],\n      filename: \"file\",\n      downloadLoading: false,\n      selectedRows: [],\n      selectedRowKeys: []\n    };\n\n    this.fetchData = () => {\n      excelList().then(response => {\n        const list = response.data.data.items;\n\n        if (this._isMounted) {\n          this.setState({\n            list\n          });\n        }\n      });\n    };\n\n    this.onSelectChange = (selectedRowKeys, selectedRows) => {\n      this.setState({\n        selectedRows,\n        selectedRowKeys\n      });\n    };\n\n    this.handleDownload = type => {\n      if (type === \"selected\" && this.state.selectedRowKeys.length === 0) {\n        _message.error(\"至少选择一项进行导出\");\n\n        return;\n      }\n\n      this.setState({\n        downloadLoading: true\n      });\n      import(\"@/lib/Export2Zip\").then(zip => {\n        const tHeader = [\"Id\", \"Title\", \"Author\", \"Readings\", \"Date\"];\n        const filterVal = [\"id\", \"title\", \"author\", \"readings\", \"date\"];\n        const list = type === \"all\" ? this.state.list : this.state.selectedRows;\n        const data = this.formatJson(filterVal, list);\n        zip.export_txt_to_zip(tHeader, data, this.state.filename, this.state.filename);\n        this.setState({\n          selectedRowKeys: [],\n          // 导出完成后将多选框清空\n          downloadLoading: false\n        });\n      });\n    };\n\n    this.filenameChange = e => {\n      this.setState({\n        filename: e.target.value\n      });\n    };\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n    this.fetchData();\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  formatJson(filterVal, jsonData) {\n    return jsonData.map(v => filterVal.map(j => v[j]));\n  }\n\n  render() {\n    const {\n      selectedRowKeys\n    } = this.state;\n    const rowSelection = {\n      selectedRowKeys,\n      onChange: this.onSelectChange\n    };\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_Collapse, {\n      defaultActiveKey: [\"1\"],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Panel, {\n      header: \"\\u5BFC\\u51FA\\u9009\\u9879\",\n      key: \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(_Form, {\n      layout: \"inline\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(_Form.Item, {\n      label: \"\\u6587\\u4EF6\\u540D:\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(_Input, {\n      style: {\n        width: \"250px\"\n      },\n      prefix: /*#__PURE__*/React.createElement(_Icon, {\n        type: \"file\",\n        style: {\n          color: \"rgba(0,0,0,.25)\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }\n      }),\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u6587\\u4EF6\\u540D(\\u9ED8\\u8BA4file)\",\n      onChange: this.filenameChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(_Form.Item, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      icon: \"file-zip\",\n      onClick: this.handleDownload.bind(null, \"all\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 17\n      }\n    }, \"\\u5168\\u90E8\\u5BFC\\u51FA\")), /*#__PURE__*/React.createElement(_Form.Item, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(_Button, {\n      type: \"primary\",\n      icon: \"file-zip\",\n      onClick: this.handleDownload.bind(null, \"selected\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 17\n      }\n    }, \"\\u5BFC\\u51FA\\u5DF2\\u9009\\u62E9\\u9879\"))))), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(_Table, {\n      bordered: true,\n      columns: columns,\n      rowKey: record => record.id,\n      dataSource: this.state.list,\n      pagination: false,\n      rowSelection: rowSelection,\n      loading: this.state.downloadLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nexport default Zip;","map":{"version":3,"sources":["/Users/flexiv/Downloads/react-antd-admin-template-master/src/views/zip/index.jsx"],"names":["React","Component","excelList","Panel","columns","title","dataIndex","key","width","align","render","author","Zip","_isMounted","state","list","filename","downloadLoading","selectedRows","selectedRowKeys","fetchData","then","response","data","items","setState","onSelectChange","handleDownload","type","length","error","zip","tHeader","filterVal","formatJson","export_txt_to_zip","filenameChange","e","target","value","componentDidMount","componentWillUnmount","jsonData","map","v","j","rowSelection","onChange","color","bind","record","id"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Table, Tag, Form, Icon, Button, Input, message, Collapse } from \"antd\";\nimport { excelList } from \"@/api/excel\";\nconst { Panel } = Collapse;\nconst columns = [\n  {\n    title: \"Id\",\n    dataIndex: \"id\",\n    key: \"id\",\n    width: 200,\n    align: \"center\",\n  },\n  {\n    title: \"Title\",\n    dataIndex: \"title\",\n    key: \"title\",\n    width: 200,\n    align: \"center\",\n  },\n  {\n    title: \"Author\",\n    key: \"author\",\n    dataIndex: \"author\",\n    width: 100,\n    align: \"center\",\n    render: (author) => <Tag key={author}>{author}</Tag>,\n  },\n  {\n    title: \"Readings\",\n    dataIndex: \"readings\",\n    key: \"readings\",\n    width: 195,\n    align: \"center\",\n  },\n  {\n    title: \"Date\",\n    dataIndex: \"date\",\n    key: \"date\",\n    width: 195,\n    align: \"center\",\n  },\n];\nclass Zip extends Component {\n  _isMounted = false; // 这个变量是用来标志当前组件是否挂载\n  state = {\n    list: [],\n    filename: \"file\",\n    downloadLoading: false,\n    selectedRows: [],\n    selectedRowKeys: [],\n  };\n  fetchData = () => {\n    excelList().then((response) => {\n      const list = response.data.data.items;\n      if (this._isMounted) {\n        this.setState({ list });\n      }\n    });\n  };\n  componentDidMount() {\n    this._isMounted = true;\n    this.fetchData();\n  }\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n  onSelectChange = (selectedRowKeys, selectedRows) => {\n    this.setState({ selectedRows, selectedRowKeys });\n  };\n  handleDownload = (type) => {\n    if (type === \"selected\" && this.state.selectedRowKeys.length === 0) {\n      message.error(\"至少选择一项进行导出\");\n      return;\n    }\n    this.setState({\n      downloadLoading: true,\n    });\n    import(\"@/lib/Export2Zip\").then((zip) => {\n      const tHeader = [\"Id\", \"Title\", \"Author\", \"Readings\", \"Date\"];\n      const filterVal = [\"id\", \"title\", \"author\", \"readings\", \"date\"];\n      const list = type === \"all\" ? this.state.list : this.state.selectedRows;\n      const data = this.formatJson(filterVal, list);\n\n      zip.export_txt_to_zip(\n        tHeader,\n        data,\n        this.state.filename,\n        this.state.filename\n      );\n      this.setState({\n        selectedRowKeys: [], // 导出完成后将多选框清空\n        downloadLoading: false,\n      });\n    });\n  };\n  formatJson(filterVal, jsonData) {\n    return jsonData.map((v) => filterVal.map((j) => v[j]));\n  }\n  filenameChange = (e) => {\n    this.setState({\n      filename: e.target.value,\n    });\n  };\n  render() {\n    const { selectedRowKeys } = this.state;\n    const rowSelection = {\n      selectedRowKeys,\n      onChange: this.onSelectChange,\n    };\n    return (\n      <div className=\"app-container\">\n        <Collapse defaultActiveKey={[\"1\"]}>\n          <Panel header=\"导出选项\" key=\"1\">\n            <Form layout=\"inline\">\n              <Form.Item label=\"文件名:\">\n                <Input\n                  style={{ width: \"250px\" }}\n                  prefix={\n                    <Icon type=\"file\" style={{ color: \"rgba(0,0,0,.25)\" }} />\n                  }\n                  placeholder=\"请输入文件名(默认file)\"\n                  onChange={this.filenameChange}\n                />\n              </Form.Item>\n              <Form.Item>\n                <Button\n                  type=\"primary\"\n                  icon=\"file-zip\"\n                  onClick={this.handleDownload.bind(null, \"all\")}\n                >\n                  全部导出\n                </Button>\n              </Form.Item>\n              <Form.Item>\n                <Button\n                  type=\"primary\"\n                  icon=\"file-zip\"\n                  onClick={this.handleDownload.bind(null, \"selected\")}\n                >\n                  导出已选择项\n                </Button>\n              </Form.Item>\n            </Form>\n          </Panel>\n        </Collapse>\n        <br />\n        <Table\n          bordered\n          columns={columns}\n          rowKey={(record) => record.id}\n          dataSource={this.state.list}\n          pagination={false}\n          rowSelection={rowSelection}\n          loading={this.state.downloadLoading}\n        />\n      </div>\n    );\n  }\n}\n\nexport default Zip;\n"]},"metadata":{},"sourceType":"module"}