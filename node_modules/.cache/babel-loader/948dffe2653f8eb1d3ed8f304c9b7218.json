{"ast":null,"code":"import \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/menu/style\";\nimport _Menu from \"antd/es/menu\";\nvar _jsxFileName = \"/Users/flexiv/Downloads/react-antd-admin-template-master/src/views/layout/Sider/Menu/index.jsx\";\nimport React, { Component } from \"react\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport { Scrollbars } from \"react-custom-scrollbars\";\nimport { connect } from \"react-redux\";\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\nimport { addTag } from \"@/store/actions\";\nimport { getMenuItemInMenuListByProperty } from \"@/utils\";\nimport menuList from \"@/config/menuConfig\";\nimport \"./index.less\";\nconst SubMenu = _Menu.SubMenu; // 重新记录数组顺序\n\nconst reorder = (list, startIndex, endIndex) => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n  return result;\n};\n\nclass Meun extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      menuTreeNode: null,\n      openKey: []\n    };\n\n    this.filterMenuItem = item => {\n      const {\n        roles\n      } = item;\n      const {\n        role\n      } = this.props;\n\n      if (role === \"admin\" || !roles || roles.includes(role)) {\n        return true;\n      } else if (item.children) {\n        // 如果当前用户有此item的某个子item的权限\n        return !!item.children.find(child => roles.includes(child.role));\n      }\n\n      return false;\n    };\n\n    this.getMenuNodes = menuList => {\n      // 得到当前请求的路由路径\n      const path = this.props.location.pathname;\n      return menuList.reduce((pre, item) => {\n        if (this.filterMenuItem(item)) {\n          if (!item.children) {\n            pre.push( /*#__PURE__*/React.createElement(_Menu.Item, {\n              key: item.path,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 46,\n                columnNumber: 13\n              }\n            }, /*#__PURE__*/React.createElement(Link, {\n              to: item.path,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 47,\n                columnNumber: 15\n              }\n            }, item.icon ? /*#__PURE__*/React.createElement(_Icon, {\n              type: item.icon,\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 48,\n                columnNumber: 30\n              }\n            }) : null, /*#__PURE__*/React.createElement(\"span\", {\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 49,\n                columnNumber: 17\n              }\n            }, item.title))));\n          } else {\n            // 查找一个与当前请求路径匹配的子Item\n            const cItem = item.children.find(cItem => path.indexOf(cItem.path) === 0); // 如果存在, 说明当前item的子列表需要打开\n\n            if (cItem) {\n              this.setState(state => ({\n                openKey: [...state.openKey, item.path]\n              }));\n            } // 向pre添加<SubMenu>\n\n\n            pre.push( /*#__PURE__*/React.createElement(SubMenu, {\n              key: item.path,\n              title: /*#__PURE__*/React.createElement(\"span\", {\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 70,\n                  columnNumber: 17\n                }\n              }, item.icon ? /*#__PURE__*/React.createElement(_Icon, {\n                type: item.icon,\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 71,\n                  columnNumber: 32\n                }\n              }) : null, /*#__PURE__*/React.createElement(\"span\", {\n                __self: this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 72,\n                  columnNumber: 19\n                }\n              }, item.title)),\n              __self: this,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 67,\n                columnNumber: 13\n              }\n            }, this.getMenuNodes(item.children)));\n          }\n        }\n\n        return pre;\n      }, []);\n    };\n\n    this.onDragEnd = result => {\n      if (!result.destination) {\n        return;\n      }\n\n      const _items = reorder(this.state.menuTreeNode, result.source.index, result.destination.index);\n\n      this.setState({\n        menuTreeNode: _items\n      });\n    };\n\n    this.handleMenuSelect = ({\n      key = \"/dashboard\"\n    }) => {\n      let menuItem = getMenuItemInMenuListByProperty(menuList, \"path\", key);\n      this.props.addTag(menuItem);\n    };\n  }\n\n  componentWillMount() {\n    const menuTreeNode = this.getMenuNodes(menuList);\n    this.setState({\n      menuTreeNode\n    });\n    this.handleMenuSelect(this.state.openKey);\n  }\n\n  render() {\n    const path = this.props.location.pathname;\n    const openKey = this.state.openKey;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sidebar-menu-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Scrollbars, {\n      autoHide: true,\n      autoHideTimeout: 1000,\n      autoHideDuration: 200,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(DragDropContext, {\n      onDragEnd: this.onDragEnd,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Droppable, {\n      droppableId: \"droppable\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }\n    }, (provided, snapshot) => /*#__PURE__*/React.createElement(\"div\", Object.assign({}, provided.droppableProps, {\n      ref: provided.innerRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }\n    }), this.state.menuTreeNode.map((item, index) => /*#__PURE__*/React.createElement(Draggable, {\n      key: item.key,\n      draggableId: item.key,\n      index: index,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 21\n      }\n    }, (provided, snapshot) => /*#__PURE__*/React.createElement(\"div\", Object.assign({\n      ref: provided.innerRef\n    }, provided.draggableProps, provided.dragHandleProps, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(_Menu, {\n      mode: \"inline\",\n      theme: \"dark\",\n      onSelect: this.handleMenuSelect,\n      selectedKeys: [path],\n      defaultOpenKeys: openKey,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 27\n      }\n    }, item)))))))));\n  }\n\n}\n\nexport default connect(state => state.user, {\n  addTag\n})(withRouter(Meun));","map":{"version":3,"sources":["/Users/flexiv/Downloads/react-antd-admin-template-master/src/views/layout/Sider/Menu/index.jsx"],"names":["React","Component","Link","withRouter","Scrollbars","connect","DragDropContext","Droppable","Draggable","addTag","getMenuItemInMenuListByProperty","menuList","SubMenu","reorder","list","startIndex","endIndex","result","Array","from","removed","splice","Meun","state","menuTreeNode","openKey","filterMenuItem","item","roles","role","props","includes","children","find","child","getMenuNodes","path","location","pathname","reduce","pre","push","icon","title","cItem","indexOf","setState","onDragEnd","destination","_items","source","index","handleMenuSelect","key","menuItem","componentWillMount","render","provided","snapshot","droppableProps","innerRef","map","draggableProps","dragHandleProps","user"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Menu, Icon } from \"antd\";\nimport { Link, withRouter } from \"react-router-dom\";\nimport { Scrollbars } from \"react-custom-scrollbars\";\nimport { connect } from \"react-redux\";\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\nimport { addTag } from \"@/store/actions\";\nimport { getMenuItemInMenuListByProperty } from \"@/utils\";\nimport menuList from \"@/config/menuConfig\";\nimport \"./index.less\";\nconst SubMenu = Menu.SubMenu;\n// 重新记录数组顺序\nconst reorder = (list, startIndex, endIndex) => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n  return result;\n};\n\nclass Meun extends Component {\n  state = {\n    menuTreeNode: null,\n    openKey: [],\n  };\n\n  // filterMenuItem用来根据配置信息筛选可以显示的菜单项\n  filterMenuItem = (item) => {\n    const { roles } = item;\n    const { role } = this.props;\n    if (role === \"admin\" || !roles || roles.includes(role)) {\n      return true;\n    } else if (item.children) {\n      // 如果当前用户有此item的某个子item的权限\n      return !!item.children.find((child) => roles.includes(child.role));\n    }\n    return false;\n  };\n  // 菜单渲染\n  getMenuNodes = (menuList) => {\n    // 得到当前请求的路由路径\n    const path = this.props.location.pathname;\n    return menuList.reduce((pre, item) => {\n      if (this.filterMenuItem(item)) {\n        if (!item.children) {\n          pre.push(\n            <Menu.Item key={item.path}>\n              <Link to={item.path}>\n                {item.icon ? <Icon type={item.icon} /> : null}\n                <span>{item.title}</span>\n              </Link>\n            </Menu.Item>\n          );\n        } else {\n          // 查找一个与当前请求路径匹配的子Item\n          const cItem = item.children.find(\n            (cItem) => path.indexOf(cItem.path) === 0\n          );\n          // 如果存在, 说明当前item的子列表需要打开\n          if (cItem) {\n            this.setState((state) => ({\n              openKey: [...state.openKey, item.path],\n            }));\n          }\n\n          // 向pre添加<SubMenu>\n          pre.push(\n            <SubMenu\n              key={item.path}\n              title={\n                <span>\n                  {item.icon ? <Icon type={item.icon} /> : null}\n                  <span>{item.title}</span>\n                </span>\n              }\n            >\n              {this.getMenuNodes(item.children)}\n            </SubMenu>\n          );\n        }\n      }\n\n      return pre;\n    }, []);\n  };\n\n  onDragEnd = (result) => {\n    if (!result.destination) {\n      return;\n    }\n    const _items = reorder(\n      this.state.menuTreeNode,\n      result.source.index,\n      result.destination.index\n    );\n    this.setState({\n      menuTreeNode: _items,\n    });\n  };\n\n  handleMenuSelect = ({ key = \"/dashboard\" }) => {\n    let menuItem = getMenuItemInMenuListByProperty(menuList, \"path\", key);\n    this.props.addTag(menuItem);\n  };\n\n  componentWillMount() {\n    const menuTreeNode = this.getMenuNodes(menuList);\n    this.setState({\n      menuTreeNode,\n    });\n    this.handleMenuSelect(this.state.openKey);\n  }\n  render() {\n    const path = this.props.location.pathname;\n    const openKey = this.state.openKey;\n    return (\n      <div className=\"sidebar-menu-container\">\n        <Scrollbars autoHide autoHideTimeout={1000} autoHideDuration={200}>\n          <DragDropContext onDragEnd={this.onDragEnd}>\n            <Droppable droppableId=\"droppable\">\n              {(provided, snapshot) => (\n                <div {...provided.droppableProps} ref={provided.innerRef}>\n                  {this.state.menuTreeNode.map((item, index) => (\n                    <Draggable\n                      key={item.key}\n                      draggableId={item.key}\n                      index={index}\n                    >\n                      {(provided, snapshot) => (\n                        <div\n                          ref={provided.innerRef}\n                          {...provided.draggableProps}\n                          {...provided.dragHandleProps}\n                        >\n                          <Menu\n                            mode=\"inline\"\n                            theme=\"dark\"\n                            onSelect={this.handleMenuSelect}\n                            selectedKeys={[path]}\n                            defaultOpenKeys={openKey}\n                          >\n                            {item}\n                          </Menu>\n                        </div>\n                      )}\n                    </Draggable>\n                  ))}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        </Scrollbars>\n      </div>\n    );\n  }\n}\n\nexport default connect((state) => state.user, { addTag })(withRouter(Meun));\n"]},"metadata":{},"sourceType":"module"}